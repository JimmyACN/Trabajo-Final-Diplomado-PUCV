---
title: "Jimmy_Carrillo_Trabajo_Final"
author: "Jimmy Carrillo Novoa"
date: "14/7/2021"
output: pdf_document
---

```{r setup, include=TRUE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
library(readxl)
library(ggplot2)
library(dplyr)
library(multcomp)
library(psych)
library(car)
library(nlme)
library(lme4)
library(readr)
library(lmtest)
library(boot)
library(MVN)
```

## ANALISIS PARTE 1
## ANALISIS DE MODELOS LINEALES MIXTOS DE EFECTOS FIJOS Y EFECTOS ALEATORIOS PARA EL ANALISIS DEL EFECTO DE LA DENSIDAD DE CULTIVO, EL VOLUMEN DEL ESTANQUE SOBRE LA INTENSIDAD DE LUZ

##Exploratorio del Set de Datos Light_intensity. Medida de la intensidad de luz en watt/m2 de diferentes estqnues a diferentes densidades de cultivo en dos Modulos de cultivo diferentes. 

```{r}
light <- read_excel("Light_intensity.xlsx")
```


## Exploratorio de las avriables a analizar


```{r}
str(light)
```

## Ajuste de la variable y Resumen de las variables.


```{r}
light$Module <- as.factor(light$Module)
light$Volume_m3 <- as.factor(light$Volume_m3)
light$Tank <- as.factor(light$Tank)
str(light)
```

## Resumen estadistico de la variables

```{r}
summary(light)
```

## Analisis exploratorio de las variables.

## Box-plot de intensidad de luz- watt/sqr 2 en Modulo A y Modulo B

```{r}
ggplot(data = light,aes(x= Module, y = watt_sq2, fill=Module)) +
  geom_boxplot() + theme(legend.position = 'right')

```

## Plot de intensidad de luz- watt/sqr 2 en Modulo A y Modulo B

```{r}
p <- ggplot(data = light,aes(x = Module, y = watt_sq2))
p + geom_point(aes(colour = Volume_m3)) + stat_smooth(se = FALSE)
```

## Histograma de la variable respuesta light watt/m2


```{r}
ggplot(light, aes(x=watt_sq2))+
  geom_histogram(color="darkblue", fill="red")
```


## Histograma de la variable respuesta light watt/m2 con la curva normal teorica

```{r}
ggplot(data = light, aes(x = watt_sq2)) +
  geom_histogram(aes(y = ..density.., fill = ..count..)) +
  scale_fill_gradient(low = "#DCDCDC", high = "#7C7C7C") +
  # scale_fill_gradient(low = 1, high = 2) +
  stat_function(fun = dnorm, colour = "firebrick",
                args = list(mean = mean(light$watt_sq2),
                            sd = sd(light$watt_sq2))) +
  ggtitle("Histograma de light + Curva normal teÃ³rica") +
  theme_bw()
```

## Test de Normalidad para la variable respuesta light watt_sq2

```{r}
shapiro.test (light$watt_sq2)
```
## La variable respuesta no presenta normalidad.

#
#

## ANALISIS DE MODELOS LINEALES MIXTOS##

#
## Modelo de efectos fijos.

#
## Ajuste de un modelo de efectos fijos donde la variable respuesta es light intensity y como efectos fijos del modelo las variables Density y Volumen de estanque. Density y Volumen como variables predictoras.  



## Modelo 1 de efectos fijos
```{r}
mod.1a <- lm(watt_sq2 ~ Density, data = light)
pander::pander(summary(mod.1a), caption = "Modelo de efectos fijos de la variable respuesta light y la interaccion de las variable predictora Density mas volume_m3")
```

## PLot Modelo 1 efectos fijos

```{r}
plot(light$watt_sq2,light$Density)
abline(coef(mod.1a))
```

## Modelo 2 de efectos fijos

```{r}
mod.1b <- lm(watt_sq2 ~ Density + Volume_m3, data = light)

pander::pander(summary(mod.1b), caption = "Modelo de efectos fijos de la variable respuesta light y la interaccion de las variable predictora Density mas volume_m3")
```

## Plot del modelo


```{r}
par(mfrow=c(2,2))
plot(mod.1b)
```

## Test de normalidad para el modelos de efectos fijos 

```{r}
shapiro.test (residuals (mod.1b))
```
## EL modelo de efectos fijos no presenta normalidad


## Modelo Integrado 1

```{r}
mod.1.int <- lm(watt_sq2 ~ Density:Volume_m3, data = light)

pander::pander(summary(mod.1.int), caption = "Modelo de efectos fijos de la variable respuesta light y el efecto de interaccion entre variable predictora Density y volume_m3")
```


## Plot del Modelo

```{r}
par(mfrow=c(2,2))
plot(mod.1.int)
```

## Modelo integrado 2

```{r}
mod.2.int <- lm(watt_sq2 ~ Density+Volume_m3+Density:Volume_m3, data = light)

pander::pander(summary(mod.2.int), caption = "Modelo de efectos fijos de la variable respuesta light y el efecto de interaccion de las variable predictora Density y volume_m3 mas el efecto entre Density y Volume_m3")
```

## Plot del modelo
```{r}
par(mfrow=c(2,2))
plot(mod.2.int)
```


## Test de normalidad para los modelos integrados 

```{r}
shapiro.test (residuals (mod.1.int))
shapiro.test (residuals (mod.2.int))
```
## Los modelo integrados no presentan normalidad
## El valor de p-value es menor a 0.05 por lo tanto el modelo no presenta una distribucion normal.    


## MODELOS CON EFECTOS ALEATORIOS

## Modelo con efectos aleatorios 1

```{r}
mod.A.1 <- lmer(watt_sq2 ~ Density + Volume_m3 + (1|Module), data = light)
summary(mod.A.1)
```

## Modelo de efectos aleatorios 2

```{r}
mod.A.2 <- lmer(watt_sq2 ~ Density+Volume_m3+Density:Volume_m3 + (1|Module), data = light)
summary(mod.A.2)
```

## Test de Normalidad para los modelos aleatorios.

```{r}
shapiro.test (residuals (mod.A.1))
shapiro.test (residuals (mod.A.2))
```

## Los modelos aleatorios no presentan normalidad

## Los modelos lineales modelados anteriormente asi como la variable respuesta Watt_sq2 no presentan una distribucion normal, por lo tanto no se cumplen con los supuestos de los Modelos Lineales Mixtos. 

## La avriable predictora Volume_m3 presenta solo dos niveles (binomial) 50m3 y 200 m3 por lo tanto no pueden ser considerado como un efecto aleatorio.

## Conclusion del analisis 1: No se puede determinar mediante un analisis de modelos lineales de efectos fijos y efectos aleatorios el efecto de la densidad y el volumen en la intensidad de la luz medida en los estanques. La variable respuesta intensidad de luz: watt_sq2no tiene distribucion normal y la variable predictora Volume_m3 es categorica binomial.



## ANALISIS PARTE 2
## ANALISIS DE MODELOS LINEALES GENERALIZADOS PARA EL ANALISIS DEL EFECTO DE LA DENSIDAD DE CULTIVO, EL VOLUMEN DEL ESTANQUE SOBRE LA INTENSIDAD DE LUZ


## Modelos lineales Generalizados (Bernoulli).


## Modelo lineal generalizado 1-Nulo-Sobre la variable respuesta Intensidad de luz <watt_sq2>


```{r}
mod.g1 <- glm(watt_sq2 ~ 1, family= binomial, data = light)
summary(mod.g1)
```
## El valor de p-values para el intercepto es menor que 0.05 por lo tanto el modelo tiene capacidad predictora.El intercepto del modelo es estadisticamente significativamente



## Modelo Generalizado 2 sobre la variable respuesta watt_sq2 y como variable predictora Density
  
```{r}
mod.g2 <- glm(watt_sq2 ~ Density, family= binomial, data = light)
summary(mod.g2)
```
## El valor de p-values para el intercepto es mayor que el nivel de significancia 0.05 por lo tanto no es estadisticamente significativo

## El valor de p-values para el B1 es menor que el nivel de significancia 5% por lo tanto es estadisticamente significativo


## Plot del Modelo G 2


```{r}
par(mfrow=c(2,2))
plot(mod.g2)
```



## Modelo Generalizado 3 sobre la variable respuesta watt_sq2 y como variable predictora Density usando el enlace canonico complemento "loglog"
  
  
```{r}
mod.g2a <- glm(watt_sq2 ~ Density, family= binomial(link="cloglog"), data = light)
summary(mod.g2a)
```

##  El valor de p-values para el intercepto es mayor que el nivel de significancia 0.05 por lo tanto no es estadisticamente significativo

## El valor de p-values para el B1 es menor que el nivel de significancia 5% por lo tanto es estadisticamente significativo


## Plot del Modelo G 3

```{r}
par(mfrow=c(2,2))
plot(mod.g2a)
```


## Modelo Generalizado 4  sobre la variable respuesta watt_sq2 y el efecto de las variables predictoras Density y Module usando el enlace canonico complemento "loglog"

```{r}
mod.g2aa <- glm(watt_sq2 ~ Density+Module, family= binomial(link="cloglog"), data = light)
summary(mod.g2aa)
```
## El valor de p-values para el intercepto es mayor que el nivel de significancia 0.05 por lo tanto no es estadisticamente significativo

## El valor de p-values para el B1 es menor que el nivel de significancia 5% por lo tanto es estadisticamente significativo

## El valor de p-values para el B2 es mayor que el nivel de significancia 5% por lo tanto no es estadisticamente significativo


## Plot del Modelo G 4

```{r}
par(mfrow=c(2,2))
plot(mod.g2aa)
```


## Modelo generalizado 5 sobre la variable respuesta watt_sq2 y el efecto de la variables predictora Density usando el enlace canonico complemento "probit"

```{r}
mod.g2ab <- glm(watt_sq2 ~ Density, family= binomial(link=probit), data = light)
summary(mod.g2ab)

```

## El valor de p-values para el intercepto es mayor que el nivel de significancia 0.05 por lo tanto no es estadisticamente significativo

## El valor de p-values para el B1 es menor que el nivel de significancia 5% por lo tanto es estadisticamente significativo



## Plot del Modelo G 5

```{r}
par(mfrow=c(2,2))
plot(mod.g2ab)
```


## Moddelo Generalizado 6 sobre la variable respuesta watt_sq2 y el efecto entre  variables predictoras Density y Module usando el enlace canonico complemento "probit"

```{r}
mod.g2ab1 <- glm(watt_sq2 ~ Density:Module, family= binomial(link=probit), data = light)
summary(mod.g2ab1)
```

## El valor de p-values para el intercepto es mayor que el nivel de significancia 0.05 por lo tanto no es estadisticamente significativo

## El valor de p-values para el B1 es menor que el nivel de significancia 5% por lo tanto es estadisticamente significativo

## El valor de p-values para el B2 es menor que el nivel de significancia 5% por lo tanto  es estadisticamente significativo

## Plot del Modelo G 6

```{r}
par(mfrow=c(2,2))
plot(mod.g2ab1)
```


## Model 7  sobre la variable respuesta watt_sq2 y el efecto de las variables predictoras Density y Volume usando el enlace canonico complemento "cloglog"

```{r}
mod.g2aab <- glm(watt_sq2 ~ Density+Volume_m3, family= binomial(link="cloglog"), data = light)
summary(mod.g2aab)
```

## El valor de p-values para el intercepto es mayor que el nivel de significancia 0.05 por lo tanto no es estadisticamente significativo

## El valor de p-values para el B1 es menor que el nivel de significancia 5% por lo tanto es estadisticamente significativo

## El valor de p-values para el B2 es mayor que el nivel de significancia 5% por lo tanto  no es estadisticamente significativo

## Plot del Modelo G 7

```{r}
par(mfrow=c(2,2))
plot(mod.g2aab)
```


##Comparacion de los Modelos Generalizados


```{r}
anova(mod.g2,mod.g2,mod.g2a,mod.g2aa,mod.g2ab,mod.g2ab1,mod.g2aab)
```

## De acuerdo al analisis anova la suma de cuadrados residuales de modelo 7 es menor al resto de los modelos, por lo tanto el modelo 7 Model 7: watt_sq2 ~ Density + Volume_m3 se ajusta de mejor a los datos analizados. 

## De acuerdo al analisis anova se puede decir que la densidad de cultivo y el volumen del estanque tienen un efecto en la intensidad de luz.  

## Conclusion del analisis 2: Mediante un analisis modelos generales linealizados se puede predecir el efecto de la densidad y del tamano del estqanque sobre la intensdad de la luz medida. 





